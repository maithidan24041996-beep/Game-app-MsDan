<header>
    <div class="logo" onclick="app.goHome()">
        <div class="logo-box">EN</div>
        <h1 class="title-font">FUN LABüöÄ</h1>
    </div>
    <div class="score-badge">
        <span>‚≠ê</span>
        <span id="global-score">0</span>
    </div>
</header>

<div id="app" class="container">
    <!-- Content injected by JS -->
</div>

<footer>
    <div class="teacher-name mb-1">Developed by Ms Dan ‚Äì Primary English Teacher</div>
    <div class="mb-2" style="font-size: 0.8rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;">
        Innovative Learning for Future Leaders
    </div>
    <div style="font-size: 0.7rem;">¬© 2026 ‚Äì For educational use. Powered by Ms Dan's Curriculum.</div>
</footer>

<script>
    /* ============================================================================
       TEACHER EDIT AREA - C·∫¨P NH·∫¨T N·ªòI DUNG T·∫†I ƒê√ÇY
       ============================================================================ */
    const CONTENT = [
        {
            grade: 3,
            themes: [
                {
                    title: "Sports and hobbies",
                    icon: "üè´",
                    vocab: [
                        { en: "badminton", vi: "c·∫ßu l√¥ng" },
                        { en: "volleyball", vi: "b√≥ng chuy·ªÅn" },
                        { en: "basketball", vi: "b√≥ng r·ªï" },
                        { en: "tennis", vi: "qu·∫ßn v·ª£t" },
                        { en: "soccer", vi: "b√≥ng ƒë√°" }
                        { en: "hitting", vi: "ƒë√°nh" },
                        { en: "kicking", vi: "ƒë√°" },
                        { en: "catching", vi: "b·∫Øt" },
                        { en: "throwing", vi: "n√©m" }
                         { en: "watch TV", vi: "xem ti vi" },
                        { en: "go skateboarding", vi: "ƒëi tr∆∞·ª£t v√°n" },
                        { en: "go out", vi: "ra ngo√†i" },
                        { en: "go swimming", vi: "ƒëi b∆°i" }
                    ],
                    sentences: [
                        { en: "Can you play soccer?", vi: "B·∫°n c√≥ th·ªÉ ch∆°i b√≥ng ƒë√° kh√¥ng?", missing: "soccer" },
                        { en: "Yes, I can.", vi: "t√¥i c√≥ th·ªÉ.", missing: "can" }
{ en: "No, I can't.", vi: "t√¥i kh√¥ng th·ªÉ.", missing: "can't" }
            { en: "What are you good at?", vi: "B·∫°n gi·ªèi v·ªÅ c√°i g√¨?", missing: "good" }
{ en: "I am good at kicking.", vi: "t√¥i gi·ªèi v·ªÅ ƒë√° b√≥ng.", missing: "kicking" }
                        { en: "May I watch TV?", vi: "T√¥i c√≥ th·ªÉ xem tivi ƒë∆∞·ª£c kh√¥ng?", missing: "watch" }
{ en: "Yes, you may.", vi: "V√¢ng, b·∫°n c√≥ th·ªÉ.", missing: "may" }
                        { en: "No, you may not.", vi: "Kh√¥ng, b·∫°n kh√¥ng th·ªÉ.", missing: "may" }
                    ]
                },
                {
                    title: "Clothes",
                    icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
                    vocab: [
                        { en: "dress", vi: "ƒë·∫ßm" },
                        { en: "shirt", vi: "√°o s∆° mi" },
                        { en: "shorts", vi: "qu·∫ßn sooc/qu·∫ßn c·ªôc" },
                        { en: "pants", vi: "qu·∫ßn t√¢y/qu·∫ßn d√†i" }
                        { en: "socks", vi: "ƒë√¥i t·∫•t/ ƒë√¥i v·ªõ" }
                    ],
                    sentences: [
                        { en: "What do you want?", vi: "B·∫°n mu·ªën c√°i g√¨?", missing: "want" }
                        { en: "I want some socks", vi: "T√¥i mu·ªën v√†i ƒë√¥i v·ªõ.", missing: "want" }
                    ]
                }
            ]
        },
        {
            grade: 4,
            themes: [
                {
                    title: "Getting around ",
                    icon: "ü¶Å",
                    vocab: [
                        { en: "stop", vi: "d·ª´ng l·∫°i" },
                        { en: "do not enter", vi: "c·∫•m v√†o trong" },
                        { en: "turn left", vi: "r·∫Ω tr√°i" },
                        { en: "turn right", vi: "r√™ ph·∫£i" }
                        { en: "No spacking", vi: "C·∫•m ƒë·ªó xe" }
                    ],
                    sentences: [
                        { en: "What does that sign mean?", vi: "Bi·ªÉn b√°o kia nghƒ©a l√† g√¨?", missing: "mean" }
                         { en: "It means stop", vi: "N√≥ c√≥ nghƒ©a l√† d·ª´ng l·∫°i.", missing: "means" }
                    ]
                },
                {
                    title: "Describing people",
                    icon: "‚òÄÔ∏è",
                    vocab: [
                        { en: "tall", vi: "cao" },
                        { en: "short", vi: "th·∫•p" },
                        { en: "big", vi: "to b√©o" },
                        { en: "slim", vi: "g·∫ßy" }
                        { en: "strong", vi: "kh·ªèe" },
                        { en: "weak", vi: "y·∫øu" }
                    ],
                    sentences: [
                        { en: "Is your father big or slim?", vi: "B·ªë c·ªßa b·∫°n to b√©o hay g·∫ßy?", missing: "Is" }
                         { en: "He's slim.", vi: "√îng ·∫•y g·∫ßy.", missing: "is" }
                    ]
                }
            ]
        },
        {
            grade: 5,
            themes: [
                {
                    title: "Health",
                    icon: "üßë‚Äç‚öïÔ∏è",
                    vocab: [
                        { en: "the flu", vi: "c·∫£m c√∫m" },
                        { en: "the chickenpox", vi: "th·ªßy ƒë·∫≠u" },
                        { en: "a headache", vi: "ƒëau ƒë·∫ßu" },
                        { en: "a stomachache", vi: "ƒëau b·ª•ng" }
                        { en: "a toothache", vi: "ƒëau rƒÉng" },
                        { en: "a earache", vi: "ƒëau tai" }
                    ],
                    sentences: [
                        { en: "what's wrong?", vi: "C√≥ v·∫•n ƒë·ªÅ g√¨ v·∫≠y?", missing: "is" }
                        { en: "I have a toothache.", vi: "T√¥i b·ªã ƒëau rƒÉng.", missing: "have" }
                    ]
                }
            ]
        }
    ];

    /* ============================================================================
       END OF TEACHER EDIT AREA
       ============================================================================ */

    // App Core
    const app = {
        state: {
            view: 'grades', // grades, themes, games, playing
            score: 0,
            selectedGrade: null,
            selectedTheme: null,
            currentGame: null
        },

        init() {
            this.render();
        },

        updateScore(points) {
            this.state.score += points;
            document.getElementById('global-score').innerText = this.state.score;
        },

        goHome() {
            this.state.view = 'grades';
            this.render();
        },

        render() {
            const container = document.getElementById('app');
            container.innerHTML = '';
            
            switch(this.state.view) {
                case 'grades': this.renderGrades(container); break;
                case 'themes': this.renderThemes(container); break;
                case 'games': this.renderGames(container); break;
                case 'playing': this.renderGameView(container); break;
            }
        },

        renderGrades(el) {
            el.innerHTML = `
                <div class="animate-in text-center mb-4">
                    <h2 class="title-font mb-1" style="font-size: 2.5rem; color: #075985;">Welcome Students!</h2>
                    <p style="font-weight: 700; color: var(--primary);">L·ª±a ch·ªçn kh·ªëi l·ªõp c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu nh√©</p>
                </div>
                <div class="grid grid-3 animate-in">
                    <div class="card grade-card grade-3" onclick="app.selectGrade(3)">
                        <div style="font-size: 1.2rem; font-weight: 800; opacity: 0.7;">GRADE</div>
                        <h2>3</h2>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white;">START</button>
                    </div>
                    <div class="card grade-card grade-4" onclick="app.selectGrade(4)">
                        <div style="font-size: 1.2rem; font-weight: 800; opacity: 0.7;">GRADE</div>
                        <h2>4</h2>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white;">START</button>
                    </div>
                    <div class="card grade-card grade-5" onclick="app.selectGrade(5)">
                        <div style="font-size: 1.2rem; font-weight: 800; opacity: 0.7;">GRADE</div>
                        <h2>5</h2>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white;">START</button>
                    </div>
                </div>
            `;
        },

        selectGrade(grade) {
            this.state.selectedGrade = CONTENT.find(c => c.grade === grade);
            this.state.view = 'themes';
            this.render();
        },

        renderThemes(el) {
            const themes = this.state.selectedGrade.themes;
            let html = `
                <div class="animate-in mb-4 flex items-center justify-between bg-white p-4 rounded-3xl shadow-sm">
                    <button class="btn btn-ghost" onclick="app.goHome()">‚¨ÖÔ∏è ƒê·ªïi Kh·ªëi L·ªõp</button>
                    <h2 class="title-font text-center" style="color: var(--primary);">Grade ${this.state.selectedGrade.grade}: Ch·ªß ƒê·ªÅ</h2>
                </div>
                <div class="grid grid-3 animate-in">
            `;
            themes.forEach((theme, idx) => {
                html += `
                    <div class="card text-center cursor-pointer hover:border-primary transition-all" onclick="app.selectTheme(${idx})">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">${theme.icon}</div>
                        <h3 style="font-size: 1.5rem; font-weight: 800; color: #0369a1;">${theme.title}</h3>
                        <div style="margin-top: 10px; font-weight: 700; color: #94a3b8; font-size: 0.8rem;">
                            ${theme.vocab.length} T·ª´ v·ª±ng ‚Ä¢ ${theme.sentences.length} M·∫´u c√¢u
                        </div>
                    </div>
                `;
            });
            html += `</div>`;
            el.innerHTML = html;
        },

        selectTheme(idx) {
            this.state.selectedTheme = this.state.selectedGrade.themes[idx];
            this.state.view = 'games';
            this.render();
        },

        renderGames(el) {
            el.innerHTML = `
                <div class="animate-in mb-4 flex items-center justify-between bg-white p-4 rounded-3xl shadow-sm">
                    <button class="btn btn-ghost" onclick="app.state.view='themes'; app.render();">‚¨ÖÔ∏è Ch·ªçn L·∫°i Ch·ªß ƒê·ªÅ</button>
                    <div style="text-align: right">
                        <div style="font-size: 0.7rem; font-weight: 800; color: #94a3b8; text-transform: uppercase;">Ch·ªß ƒë·ªÅ</div>
                        <h2 class="title-font" style="color: var(--primary); font-size: 1.2rem;">${this.state.selectedTheme.title}</h2>
                    </div>
                </div>
                <div class="grid grid-3 animate-in">
                    <div class="card cursor-pointer" style="background: #fdf2f8; border-color: #fce7f3;" onclick="app.startGame('match')">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üß©</div>
                        <h3 style="color: #be185d; font-weight: 800;">GH√âP T·ª™</h3>
                        <p style="font-size: 0.9rem; font-weight: 600; color: #db2777;">N·ªëi t·ª´ Anh - Vi·ªát</p>
                    </div>
                    <div class="card cursor-pointer" style="background: #ecfdf5; border-color: #d1fae5;" onclick="app.startGame('quiz')">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üéØ</div>
                        <h3 style="color: #047857; font-weight: 800;">TR·∫ÆC NGHI·ªÜM</h3>
                        <p style="font-size: 0.9rem; font-weight: 600; color: #059669;">Ch·ªçn nghƒ©a ƒë√∫ng</p>
                    </div>
                    <div class="card cursor-pointer" style="background: #fffbeb; border-color: #fef3c7;" onclick="app.startGame('listen')">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üéß</div>
                        <h3 style="color: #b45309; font-weight: 800;">NGHE & CH·ªåN</h3>
                        <p style="font-size: 0.9rem; font-weight: 600; color: #d97706;">Luy·ªán k·ªπ nƒÉng nghe</p>
                    </div>
                    <div class="card cursor-pointer" style="background: #eff6ff; border-color: #dbeafe;" onclick="app.startGame('order')">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üî°</div>
                        <h3 style="color: #1d4ed8; font-weight: 800;">S·∫ÆP X·∫æP C√ÇU</h3>
                        <p style="font-size: 0.9rem; font-weight: 600; color: #2563eb;">Luy·ªán vi·∫øt c√¢u</p>
                    </div>
                </div>
            `;
        },

        startGame(type) {
            this.state.view = 'playing';
            this.state.currentGame = type;
            this.render();
            this.initGameLogic(type);
        },

        renderGameView(el) {
            el.innerHTML = `
                <div class="animate-in mb-4 flex items-center justify-between">
                    <button class="btn btn-ghost" onclick="app.state.view='games'; app.render();">Tho√°t</button>
                    <h2 id="game-title" class="title-font" style="color: var(--primary);">ƒêang ch∆°i...</h2>
                </div>
                <div id="game-container" class="animate-in"></div>
            `;
        },

        initGameLogic(type) {
            const container = document.getElementById('game-container');
            const title = document.getElementById('game-title');

            if (type === 'match') {
                title.innerText = "üß© Gh√©p T·ª´";
                this.runMatchGame(container);
            } else if (type === 'quiz') {
                title.innerText = "üéØ Tr·∫Øc Nghi·ªám";
                this.runQuizGame(container);
            } else if (type === 'listen') {
                title.innerText = "üéß Nghe v√† Ch·ªçn";
                this.runListenGame(container);
            } else if (type === 'order') {
                title.innerText = "üî° S·∫Øp X·∫øp C√¢u";
                this.runOrderGame(container);
            }
        },

        // --- Game: Matching ---
        runMatchGame(el) {
            const vocab = this.state.selectedTheme.vocab;
            let cards = [];
            vocab.forEach((v, i) => {
                cards.push({ id: i, text: v.en, type: 'en' });
                cards.push({ id: i, text: v.vi, type: 'vi' });
            });
            cards.sort(() => Math.random() - 0.5);

            el.innerHTML = `<div class="game-grid" id="match-grid"></div>`;
            const grid = document.getElementById('match-grid');
            let firstSelected = null;

            cards.forEach((card, idx) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'match-card';
                cardEl.innerText = card.text;
                cardEl.onclick = () => {
                    if (cardEl.classList.contains('matched')) return;
                    if (card.type === 'en') this.speak(card.text);

                    if (firstSelected) {
                        if (firstSelected.idx === idx) {
                            cardEl.classList.remove('selected');
                            firstSelected = null;
                            return;
                        }

                        if (firstSelected.id === card.id && firstSelected.type !== card.type) {
                            // Match!
                            cardEl.classList.add('matched');
                            firstSelected.el.classList.add('matched');
                            firstSelected.el.classList.remove('selected');
                            this.updateScore(10);
                            firstSelected = null;
                            
                            // Check win
                            if (document.querySelectorAll('.match-card.matched').length === cards.length) {
                                setTimeout(() => alert("Ho√†n th√†nh! B·∫°n th·∫≠t gi·ªèi! üåü"), 500);
                            }
                        } else {
                            // No match
                            firstSelected.el.classList.remove('selected');
                            cardEl.classList.add('selected');
                            firstSelected = { id: card.id, type: card.type, el: cardEl, idx };
                        }
                    } else {
                        cardEl.classList.add('selected');
                        firstSelected = { id: card.id, type: card.type, el: cardEl, idx };
                    }
                };
                grid.appendChild(cardEl);
            });
        },

        // --- Game: Quiz ---
        runQuizGame(el) {
            const vocab = [...this.state.selectedTheme.vocab];
            let currentIdx = 0;

            const nextQuestion = () => {
                if (currentIdx >= vocab.length) {
                    el.innerHTML = `<div class="card text-center"><h2>Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh b√†i thi.</h2><button class="btn btn-primary mt-4" onclick="app.state.view='games'; app.render();">Quay l·∫°i</button></div>`;
                    return;
                }

                const q = vocab[currentIdx];
                this.speak(q.en);
                const distractors = vocab.filter(v => v.en !== q.en).map(v => v.vi);
                const options = [q.vi, ...distractors.slice(0, 3)].sort(() => Math.random() - 0.5);

                el.innerHTML = `
                    <div class="card animate-in">
                        <div class="text-center mb-4">
                            <h2 style="font-size: 3rem; color: var(--primary); font-weight: 800;">${q.en}</h2>
                            <button class="btn btn-ghost" onclick="app.speak('${q.en}')">üîä Nghe L·∫°i</button>
                        </div>
                        <div id="quiz-options"></div>
                    </div>
                `;

                const optContainer = document.getElementById('quiz-options');
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'quiz-option';
                    btn.innerText = opt;
                    btn.onclick = () => {
                        if (opt === q.vi) {
                            btn.classList.add('correct');
                            this.updateScore(10);
                            setTimeout(() => { currentIdx++; nextQuestion(); }, 1000);
                        } else {
                            btn.classList.add('wrong');
                            setTimeout(() => btn.classList.remove('wrong'), 500);
                        }
                    };
                    optContainer.appendChild(btn);
                });
            };

            nextQuestion();
        },

        // --- Game: Listening ---
        runListenGame(el) {
            const vocab = [...this.state.selectedTheme.vocab];
            let currentIdx = 0;

            const nextQuestion = () => {
                if (currentIdx >= vocab.length) {
                    el.innerHTML = `<div class="card text-center"><h2>Gi·ªèi qu√°! K·ªπ nƒÉng nghe c·ªßa b·∫°n r·∫•t tuy·ªát!</h2><button class="btn btn-primary mt-4" onclick="app.state.view='games'; app.render();">Quay l·∫°i</button></div>`;
                    return;
                }

                const q = vocab[currentIdx];
                this.speak(q.en);
                const distractors = vocab.filter(v => v.en !== q.en).map(v => v.en);
                const options = [q.en, ...distractors.slice(0, 3)].sort(() => Math.random() - 0.5);

                el.innerHTML = `
                    <div class="card animate-in text-center">
                        <div class="mb-4">
                            <div style="font-size: 5rem; cursor: pointer; display: inline-block;" onclick="app.speak('${q.en}')">üîä</div>
                            <p style="font-weight: 700; color: #94a3b8;">Nh·∫•p v√†o loa ƒë·ªÉ nghe</p>
                        </div>
                        <div class="game-grid" id="listen-options" style="grid-template-columns: repeat(2, 1fr)"></div>
                    </div>
                `;

                const optContainer = document.getElementById('listen-options');
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'quiz-option';
                    btn.style.textAlign = 'center';
                    btn.innerText = opt;
                    btn.onclick = () => {
                        if (opt === q.en) {
                            btn.classList.add('correct');
                            this.updateScore(10);
                            setTimeout(() => { currentIdx++; nextQuestion(); }, 1000);
                        } else {
                            btn.classList.add('wrong');
                        }
                    };
                    optContainer.appendChild(btn);
                });
            };

            nextQuestion();
        },

        // --- Game: Sentence Order ---
        runOrderGame(el) {
            const sentences = [...this.state.selectedTheme.sentences];
            let currentIdx = 0;

            const nextQuestion = () => {
                if (currentIdx >= sentences.length) {
                    el.innerHTML = `<div class="card text-center"><h2>B·∫°n ƒë√£ l√†m ch·ªß c√°c m·∫´u c√¢u r·ªìi!</h2><button class="btn btn-primary mt-4" onclick="app.state.view='games'; app.render();">Quay l·∫°i</button></div>`;
                    return;
                }

                const q = sentences[currentIdx];
                const fullSentence = q.en;
                const words = fullSentence.replace(/[?.!]/g, '').split(' ').sort(() => Math.random() - 0.5);
                let currentSelection = [];

                const updateUI = () => {
                    el.innerHTML = `
                        <div class="card animate-in text-center">
                            <p style="font-size: 1.2rem; font-weight: 700; color: #64748b; margin-bottom: 1rem;">"${q.vi}"</p>
                            <div class="sentence-slot" id="slot"></div>
                            <div id="pills"></div>
                            <div style="margin-top: 2rem;">
                                <button class="btn btn-primary" id="check-btn">Ki·ªÉm Tra</button>
                                <button class="btn btn-ghost" id="reset-btn">L√†m l·∫°i</button>
                            </div>
                        </div>
                    `;

                    const slot = document.getElementById('slot');
                    currentSelection.forEach((w, i) => {
                        const pill = document.createElement('span');
                        pill.className = 'word-pill';
                        pill.innerText = w;
                        pill.onclick = () => {
                            currentSelection.splice(i, 1);
                            words.push(w);
                            updateUI();
                        };
                        slot.appendChild(pill);
                    });

                    const pillsContainer = document.getElementById('pills');
                    words.forEach((w, i) => {
                        const pill = document.createElement('span');
                        pill.className = 'word-pill';
                        pill.innerText = w;
                        pill.onclick = () => {
                            currentSelection.push(w);
                            words.splice(i, 1);
                            updateUI();
                        };
                        pillsContainer.appendChild(pill);
                    });

                    document.getElementById('check-btn').onclick = () => {
                        if (currentSelection.join(' ').toLowerCase() === fullSentence.replace(/[?.!]/g, '').toLowerCase()) {
                            this.speak(fullSentence);
                            document.getElementById('slot').style.background = '#d1fae5';
                            document.getElementById('slot').style.borderColor = '#10b981';
                            this.updateScore(20);
                            setTimeout(() => { currentIdx++; nextQuestion(); }, 1500);
                        } else {
                            document.getElementById('slot').style.background = '#fee2e2';
                            document.getElementById('slot').style.borderColor = '#ef4444';
                            setTimeout(() => {
                                document.getElementById('slot').style.background = '#f8fafc';
                                document.getElementById('slot').style.borderColor = '#cbd5e1';
                            }, 1000);
                        }
                    };

                    document.getElementById('reset-btn').onclick = () => {
                        currentIdx = currentIdx; // stay
                        nextQuestion();
                    };
                };

                updateUI();
            };

            nextQuestion();
        },

        speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const ut = new SpeechSynthesisUtterance(text);
                ut.lang = 'en-US';
                ut.rate = 0.8;
                window.speechSynthesis.speak(ut);
            }
        }
    };

    // Start app
    app.init();

</script>
